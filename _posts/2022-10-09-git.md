---
layout: post
title: Git
permalink: code/git
tags: Code

---

__Git__ is for collaboration. Its like a non-automated version of google-drive sync that is designed to show you every single file change, deletion or addition. It has multiple 'branches' which are parallel versions of the repository. You work on a branch and only merge the changes with the main periodically, when you're confident it works

- [git](https://gitforwindows.org/) software is the back-end. Its a ubiquitous open source software you have have to download.
- GitHub is a remote server which you can upload or download your repositories to and from and view it online using the git protocol
- git-graph is the visualisation of all the changes to all the branches. PyCharm has functionality to switch the git-branch and upload and download changes built in to the GUI. In VScode, you have to download an extension called git graph to do it properly.

***

## Technical Terms

The following terms have very specific meanings in the context of git, which are essential to understand.

- Checkout - choose a different branch or inspect a previous commit. To move to another branch, you need to commit or cache any changes in the current worktree. Checkout closes all the files from that branch and creates a new folder structure locally inside the repository folder which corresponds to the other branch.
- Clone:  download an entire repository from GitHub, including all branches on to your local machine. It creates a folder for the repo and stores all the data in a '.git' folder inside. The folder structure  will initially be that of the 'main' branch.
- Commit Pointer: The current location in the commit history. Changed with git-reset.
- Commit - the act of updating the local branch with any changes you have made. You have to attach a message describing the changes to each commit.
- Current Branch - The branch which you currently have checked-out. This is the current folder structure of your local repository directory.
- Dot-file i.e. `.gitignore` or `.gitattributes` or `.git`: A settings configurations file for git. You can write file names separated by linebreaks or commands into `.gitignore`, and the git program will read it and ignore those files.
- Feature branch:  In 'git-flow', a management technique, this means the branch which you are habitually check-outing and edit in order to develop a feature.
- Fetch - Compare the changes aka. 'commits' to the remote version of the current branch from online and show in your local git-graph diagram, BUT it doesn't merge them into your local branches. If changes have been made remotely, it will cause the remote (origin) branch to be different to the local branch and it will show these two branches separately in git-graph.
- Head: The commit which you are viewing the worktree from.
- Index: Git documents sometimes call it the _index_, sometimes calls it the _staging area_, and sometimesâ€”rarely these daysâ€”calls it the _cache_. The index / staging-area acts as your _proposed next commit_. They are frozen copies of the files made with `git add`. If you go to the git log. The location of the _index_ will be shown by the location of _HEAD_.
- 'Main' or 'Master' branch: the 'production' version of the code.
- Merge into current branch - Pull the changes from another branch into the current branch. Adds merge
- Origin branch - this represents the version of the a given branch which is online on git-hub aka. remote.
- Pull - download and merge all the changes from the remote version of the current branch into the local version of the current branch, BUT don't upload your changes onto the remote.
- Pull (Rebase) [should be done from main to feature]- It effectively makes the fork of your current branch begin at the current state of main, rather than where you forked it originally. It is done because when merging changes from a feature branch to main using merge, the feature branch will have an extraneous merge commit every time you need to incorporate changes. Pull (Rebase) to pull from main to feature, should be used prior to merging in order to remove those superfluous markers and make the history far easier to understand by halving the number of logged commits.
- 'Pull request' merge feature into main. Normally has to be done on github. Can download externally.
- Push - upload and merge your changes into the remote branch, but don't download any changes.
- Sync - Push and Pull i.e. synchronise local and remote so they are identical.
- Upstream changes: changes made to the remote of the branch which you haven't yet pulled.
- Worktree: A state of files. Typically, 'the worktree' means the file structure you are viewing in your repo.

***

# Key Commands

## Set your user name and user-email
Check if you have these assigned by doing:

```
git config user.name
git config user.email
```

These are what will be attached to each commit. You can set them for the current repo (the deafult), the user account, or the entire PC. 

`git config user.name sebanalysis`
`git config user.email sam@example.com"`

`git config --global user.name sebanalysis`
`git config --global user.email sam@example.com"`

`git configÂ --systemÂ user.name sebanalysis`
`git configÂ --systemÂ user.email sam@example.com`

## Stage Changes, Commit and Push

Initially at least, these are the only commands you will need on a regular basis.

1. `git status` See what is staged and if you have any untracked files.
2. `git add -A` Add new, modified and deleted everywhere in branch.
3.  `git commit -m "my commit message"` Commit with a basic message.
4. `git push` Upload to GitHub.

You can combine add and commit into one step with:

```bash
git commit -am "my message"
```

Git add also has a few other options which you will need:

- `-A` : New, modified and deleted files everywhere in branch
- `-u` : modified and deleted files everywhere in branch.
- `.` : New and modified ( in `.file`) in current- and sub-directories (including files whose names begin with a dot)
- `*` :  Not part of git. It is file [globbing](https://stackoverflow.com/questions/26042390/git-add-asterisk-vs-git-add-period/26042555#26042555) done by the shell. In summary, it means new and modified files in current- and sub-directories (but without files whose names begin with a dot)

> Note on syncing repos with other software like google drive: It is not a good idea because the changes are already made outside git, so when you open it git reads them as local changes. You then have to pull, anyway to overwrite the tracked changes.


## Undo

When you inevitably want to undo commits you could use the following:

 1. `git log` to get the commit you want to revert to. Copy the hash.
 2. `git reset <hash> --hard`  
     - Either use `--hard` to rollback the changes to all the files ( a.k.a. the work-tree).
     - Or use `--soft` to erase the interceding commit history from the log (a.k.a. the index) but keep the work-tree. This is known as 'squashing-commits'.
 3. `git add -A`
 4. `git commit -m "my commit message"`
 5. `git push --force` The next push will need the --force option as you are overwriting the contents on the remote server.

Configure the author name and email address to be used with your commits. When performed from within the repo without the `-global` or `-system` flag, this user-name and -email update only applies to this repo. Note that Git [strips some characters](http://stackoverflow.com/questions/26159274/is-it-possible-to-have-a-trailing-period-in-user-name-in-git/26219423#26219423) (for example trailing periods) from `user.name`.

```bash
`git config user.name "Sam Smith"`
`git config user.email sam@example.com`
```

## Undoing and deleting files

There are two primary ways to undo changes in Git -- one is using `git reset` and the other is using `git revert`.

Command | Meaning
-|-
`git reset` | Unstage changes
`git restore .` | Undo: It undoes un-staged changes.
`git reset ### --soft` | Squash commits: Erase the commit history but retain the changes in the files used to squash recent commits
`git reset ### --mixed` | Squash commits: Like `--soft` but also un-stages files
`git reset ### --hard` | Undo: Rollback commits and staged changes to a previous
`git checkout ###` | Browse: Inspect the state of the work-tree, at a previous commit, whilst not loosing subsequent commits. It is called a detached-head state. Get back to the tip (the most recent commit) with `git checkout <branchname>`).
`git revert ###` | Undo and record it: Create a new commit that reverts the changes made by other commits.
`git clean -f` | Delete: all un-tracked files and directories
`git rm -rf --cached .`<br>`git add .` | Un-tracks all files: â€¦ (i.e. removes them from git index) then add all the unignored ones.

> Note: You cannot re-name a branch. You have to create a totally new branch and force push to overwrite the existing remote branch.

### Reset

Reset is the MVP of undoing commands. It is essentially a rollback feature that allows you to jump to earlier commits without preserving intermediate history.  Use this with:
    - `--soft` or `--mixed` to squash the commit history. The diffference between them is just staging of files.
    -  `--hard` to reverse all changes.

`git restore --staged` is shorthand for `git revert HEAD^ --hard`. It undoes all changes since the last commit.

To push changes, to remote, you will need to use `git push -f` as you are 'behind' remote at the time of the push and need to forcibly and permanently overwrite the remote.

Mode | Commit Pointer | Staging Area | Worktree | Effect
-|-|-|-
`--soft` | ðŸ”™| = | = | Moves the commit pointer backwards, retaining the staging. 
`--mixed` (default) | ðŸ”™| ðŸ”™|= | Like above, but also unstages files.
`--hard` | ðŸ”™|ðŸ”™|ðŸ”™ | Reset all tracked files to the state at t given commit.

***

## Rebase vs Merge

When you want to merge one branch into another, you either rebase or merge.

- `git rebase main`:  Integrate all the commits from the current branch into commit history of main.
- `git merge main`:  Add all the changes resulting from the current branch as a single commit.

If there are conflicts, git enters a new mode called 'merge mode' in which you need to resolve the conflicts. I prefer to open VSCode at this point, open the repo folder, and look at te staging area. VSCode has a good interface for dealing with conflicts.

***

## Use PowerShell Aliases

I use a number of aliases in my [PowerShell Profile](../assets/pwsh.ps1):

```powershell
New-Alias -Name g -Value git
function s { git status }
function l { & git log $args }
Function c {git commit -am $args}
function ga { git add $args }
function gb { git branch $args }
function gs { & git switch  $args }
Function gpl {git pull $args}
Function gph {git push $args}
function gt { & git log --graph --oneline --decorate $args }
function gr { & git remote -v $args}
function gf { git fetch }
```



# Resources

[Altassian most common git commands](https://confluence.atlassian.com/bitbucketserver/basic-git-commands-776639767.html)

[Official Git Documentaton](https://git-scm.com/docs)
