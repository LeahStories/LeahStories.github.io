---
layout: post
title: PowerShell Auto-Completion
permalink: code/pwsh-autocomplete
categories: Code
tags:
---

The best way to improve your efficiency in the command line is to add autocompletion. There are a few different types:

- Tab-completion: press tab and it toggles folder or file suggestions.
- Menu-complete: press Ctrl-Space and it displays either folder-file suggestion or command option in a tabular menu, which you can navigate around with arrow keys.
- Auto-prediction: press the right-arrow and it auto-completes the full command based on either history or autogenerated predictions.

PSReadline provides Menu-complete and auto-prediction. poshgit provides menu-complete for git commands and z provides auto-prediction for folder-paths.

## PowerShell Profile

You will need to import all of these modules every time you start up by adding them to the PowerShell profile. I have described this at in [PowerShell profile](./pwsh-profile).

> See my PowerShell profile: __[Download](../assets/pwsh.ps1)


## Install z Module

`z …` is functionally equivalent to `cd …` but it remember your recent calls, so you can press tab halfway through to autocomplete. It prioritises autocompletion suggestions via recency and frequency. Z is the most useful module I have.

A quick-start guide is [here](https://www.hanselman.com/blog/spend-less-time-cding-around-directories-with-the-powershell-z-shortcut).

[Here](https://github.com/badmotorfinger/z?WT.mc_id=-blog-scottha) is the source code.

```powershell
Install-Module z -AllowClobber
```

Some additional commands:

```
z -l # list z dirs
z -d # Delete dead path from suggestions
z -x # remove the current directory from the list
```

## poshgit

Poshgit provides:

- Menucomplete for git commands (Ctrl +Space)
- A less pretty Git status summary information than oh-my-posh (Disabled by default if using oh-my-posh).

First install nuget:
```powershell
Install-PackageProvider -Name NuGet
```

Command line didn't work for me , so I installed from [nuget.org](https://www.nuget.org/downloads)

Then install posh-git from nuget:
```powershell
PowerShellGet\Install-Module posh-git -Scope CurrentUser -Force
Import-Module posh-git
```

Instructions at [GitHub](https://github.com/dahlbyk/posh-git)

Now you should be able to menu-complete with git.


## PSReadline

PSReadline provides:

- Autocomplete for PowerShell command (From a Predictor and/or history) (Arrow Keys)
- MenuComplete for PowerShell commands (Ctrl + Space)

First check PowerShell version is 7 or above. Need to download the v7 or later [newest one](https://www.microsoft.com/store/productId/9MZ1SNWT0N5D) from windows store.

```
`$PSVersionTable.PSVersion`
```

Install the module:

```
Install-Module PSReadLine
```

Install the Azure commands prediction plugin separately. This is explained basically nowhere, but I found the commands [here](https://techcommunity.microsoft.com/t5/azure-tools-blog/announcing-general-availability-of-az-tools-predictor/ba-p/3297956).

```powershell
Install-module -name Az.Accounts -Force
Install-module -name Az.Tools.Predictor -Force
Enable-AzPredictor -AllSession
```

I also added the [CompletetionPredictor](https://github.com/PowerShell/CompletionPredictor/) but it didn't seem to add any useful suggestions.

```powershell
Install-Module -Name CompletionPredictor -Repository PSGallery
Import-Module -Name CompletionPredictor
```

I actually leave both of these plugins deactivated as they add 10s to the start-up time.

### Display Options

Now you have installed, you have 2 choices for your suggestions:

1. Choose between history and plugins:

```
Set-PSReadLineOption -PredictionSource HistoryAndPlugin # or History or Plugin or  none
```

2. Choose between Inline suggestions and tabulated suggestions. Press `F2` to change the prediction style.

### PSReadline Useful Resources

- [Predictions](https://jdhitsolutions.com/blog/powershell/8969/powershell-predicting-with-style/)
- [Source Code](https://github.com/PowerShell/PSReadLine)
- [Options](https://docs.microsoft.com/en-us/powershell/module/psreadline/set-psreadlineoption?view=powershell-7.2)

